<svg xmlns="http://www.w3.org/2000/svg" width="1100" height="520" viewBox="0 0 1100 520">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="8" refX="9" refY="4" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,4 L0,8 Z" fill="#333" />
    </marker>
  </defs>
  <style>
    .box { fill: #f7f7f7; stroke: #333; stroke-width: 2; rx: 10; }
    .inner { fill: #ffffff; stroke: #333; stroke-width: 1.5; rx: 8; }
    .title { font: 600 16px 'Segoe UI', Arial, sans-serif; fill: #111; }
    .text { font: 14px 'Segoe UI', Arial, sans-serif; fill: #111; }
    .small { font: 11px 'Segoe UI', Arial, sans-serif; fill: #111; }
    .legend { fill: #f7f7f7; stroke: #333; stroke-width: 1.5; rx: 8; }
    .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrow); }
    .dash { stroke-dasharray: 6 6; }
    .step { fill: #e3f2fd; stroke: #1565c0; stroke-width: 2; }
    .step-text { font: 700 12px 'Segoe UI', Arial, sans-serif; fill: #0d47a1; }
  </style>

  <!-- Columns -->
  <rect class="box" x="60" y="40" width="440" height="440" />
  <rect class="box" x="600" y="40" width="440" height="440" />

  <text class="title" x="280" y="70" text-anchor="middle">VBA</text>
  <text class="title" x="820" y="70" text-anchor="middle">Rust DLL</text>

  <!-- VBA steps -->
  <rect class="inner" x="100" y="110" width="360" height="60" />
  <circle class="step" cx="120" cy="140" r="14" />
  <text class="step-text" x="120" y="144" text-anchor="middle">A.1</text>
  <text class="text" x="280" y="135" text-anchor="middle">Call LR_OLS(VarPtr(y), n, VarPtr(X), p)</text>

  <rect class="inner" x="100" y="230" width="360" height="70" />
  <circle class="step" cx="120" cy="265" r="14" />
  <text class="step-text" x="120" y="269" text-anchor="middle">A.2</text>
  <text class="text" x="280" y="255" text-anchor="middle">Call getters (LR_Get*)</text>
  <text class="text" x="280" y="275" text-anchor="middle">Copy into VBA arrays</text>

  <rect class="inner" x="100" y="350" width="360" height="60" />
  <circle class="step" cx="120" cy="380" r="14" />
  <text class="step-text" x="120" y="384" text-anchor="middle">A.3</text>
  <text class="text" x="280" y="375" text-anchor="middle">Call LR_Free(handle)</text>

  <!-- Rust steps -->
  <rect class="inner" x="640" y="120" width="360" height="70" />
  <circle class="step" cx="660" cy="155" r="14" />
  <text class="step-text" x="660" y="159" text-anchor="middle">B.1</text>
  <text class="text" x="820" y="145" text-anchor="middle">Fit model + store result</text>
  <text class="text" x="820" y="165" text-anchor="middle">HashMap&lt;usize, FitResult&gt;</text>

  <rect class="inner" x="640" y="240" width="360" height="60" />
  <circle class="step" cx="660" cy="270" r="14" />
  <text class="step-text" x="660" y="274" text-anchor="middle">B.2</text>
  <text class="text" x="820" y="265" text-anchor="middle">Getters read handle</text>
  <text class="text" x="820" y="285" text-anchor="middle">Copy into caller buffers</text>

  <rect class="inner" x="640" y="350" width="360" height="60" />
  <circle class="step" cx="660" cy="380" r="14" />
  <text class="step-text" x="660" y="384" text-anchor="middle">B.3</text>
  <text class="text" x="820" y="380" text-anchor="middle">Remove handle from store</text>

  <!-- Arrows -->
  <line class="arrow dash" x1="460" y1="125" x2="640" y2="135" />
  <text class="small" x="550" y="118" text-anchor="middle">call into DLL</text>
  <line class="arrow dash" x1="640" y1="185" x2="460" y2="175" />
  <text class="small" x="550" y="170" text-anchor="middle">return handle (usize)</text>

  <line class="arrow dash" x1="460" y1="265" x2="640" y2="270" />
  <text class="small" x="550" y="255" text-anchor="middle">getters read handle</text>
  <line class="arrow dash" x1="460" y1="380" x2="640" y2="380" />
  <text class="small" x="550" y="370" text-anchor="middle">free handle</text>

  <!-- Vertical flow arrows -->
  <line class="arrow" x1="280" y1="170" x2="280" y2="230" />
  <line class="arrow" x1="280" y1="300" x2="280" y2="350" />
  <line class="arrow" x1="820" y1="190" x2="820" y2="240" />
  <line class="arrow" x1="820" y1="300" x2="820" y2="350" />

  <!-- Legend -->
  <rect class="legend" x="60" y="450" width="260" height="40" />
  <text class="small" x="80" y="475">A.* = VBA path</text>
  <text class="small" x="190" y="475">B.* = DLL path</text>
</svg>

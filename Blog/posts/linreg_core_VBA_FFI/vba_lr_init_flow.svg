<svg xmlns="http://www.w3.org/2000/svg" width="1100" height="680" viewBox="0 0 1100 680">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="8" refX="9" refY="4" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,4 L0,8 Z" fill="#333" />
    </marker>
  </defs>
  <style>
    .box { fill: #f7f7f7; stroke: #333; stroke-width: 2; rx: 10; }
    .inner { fill: #ffffff; stroke: #333; stroke-width: 1.5; rx: 8; }
    .diamond { fill: #f7f7f7; stroke: #333; stroke-width: 2; }
    .title { font: 600 16px 'Segoe UI', Arial, sans-serif; fill: #111; }
    .text { font: 14px 'Segoe UI', Arial, sans-serif; fill: #111; }
    .small { font: 12px 'Segoe UI', Arial, sans-serif; fill: #111; }
    .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrow); }
    .step { fill: #e3f2fd; stroke: #1565c0; stroke-width: 2; }
    .step-text { font: 700 12px 'Segoe UI', Arial, sans-serif; fill: #0d47a1; }
    .note { fill: #fff8e1; stroke: #c9a53f; stroke-width: 2; rx: 8; }
  </style>

  <text class="title" x="550" y="40" text-anchor="middle">DLL preload flow (LR_Init)</text>

  <!-- Path notes -->
  <rect class="note" x="140" y="50" width="240" height="50" />
  <text class="small" x="160" y="73">Path A (64-bit Excel):</text>
  <text class="small" x="160" y="91">loads x64 DLL</text>

  <rect class="note" x="720" y="50" width="240" height="50" />
  <text class="small" x="740" y="73">Path B (32-bit Excel):</text>
  <text class="small" x="740" y="91">loads x86 DLL</text>

  <rect class="box" x="410" y="60" width="280" height="60" />
  <circle class="step" cx="430" cy="90" r="12" />
  <text class="step-text" x="430" y="94" text-anchor="middle">1</text>
  <text class="text" x="550" y="98" text-anchor="middle">Workbook_Open</text>

  <rect class="box" x="410" y="170" width="280" height="60" />
  <circle class="step" cx="430" cy="200" r="12" />
  <text class="step-text" x="430" y="204" text-anchor="middle">2</text>
  <text class="text" x="550" y="208" text-anchor="middle">LR_Init (VBA)</text>

  <polygon class="diamond" points="550,300 620,340 550,380 480,340" />
  <text class="text" x="550" y="345" text-anchor="middle">Win64?</text>

  <!-- Win64 branch -->
  <rect class="inner" x="140" y="430" width="360" height="70" />
  <circle class="step" cx="160" cy="465" r="14" />
  <text class="step-text" x="160" y="469" text-anchor="middle">A.3</text>
  <text class="text" x="320" y="455" text-anchor="middle">LoadLibraryA</text>
  <text class="text" x="320" y="475" text-anchor="middle">ThisWorkbook.Path\\linreg_core_x64.dll</text>

  <!-- x86 branch -->
  <rect class="inner" x="600" y="430" width="360" height="70" />
  <circle class="step" cx="620" cy="465" r="14" />
  <text class="step-text" x="620" y="469" text-anchor="middle">B.3</text>
  <text class="text" x="780" y="455" text-anchor="middle">LoadLibraryA</text>
  <text class="text" x="780" y="475" text-anchor="middle">ThisWorkbook.Path\\linreg_core_x86.dll</text>

  <rect class="box" x="370" y="560" width="360" height="60" />
  <text class="text" x="550" y="598" text-anchor="middle">DLL pinned; VBA calls LR_* directly</text>

  <!-- Arrows -->
  <line class="arrow" x1="550" y1="120" x2="550" y2="170" />
  <line class="arrow" x1="550" y1="230" x2="550" y2="300" />
  <line class="arrow" x1="480" y1="340" x2="320" y2="430" />
  <line class="arrow" x1="620" y1="340" x2="780" y2="430" />
  <text class="small" x="350" y="365">yes</text>
  <text class="small" x="750" y="365">no</text>

  <line class="arrow" x1="320" y1="500" x2="550" y2="560" />
  <line class="arrow" x1="780" y1="500" x2="550" y2="560" />
</svg>
